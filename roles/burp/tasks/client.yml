---

- name: Burp | directories
  tags:
  - dirs
  file:
    path: "{{item}}"
    state: directory
    mode: 0750
  with_items:
  - /etc/burp
  - /etc/burp/keys
  - /etc/burp/upgrade

- name: Burp | dependencies
  tags:
  - package
  package:
    name: librsync-dev
    state: installed

# Binaries compiled on a Debian host from git:
# git clone https://github.com/grke/burp && cd burp/
# sudo apt-get install make pkg-config check g++ librsync-dev libz-dev libssl-dev uthash-dev libyajl-dev
# sudo apt-get install autoconf automake libtool
# autoreconf -vif
# ./configure && make

- name: Burp | executables
  tags:
  - binary
  copy:
    src: "bin/{{ burp_version }}/{{ ansible_os_family }}/{{ item }}"
    dest: /usr/sbin/
    mode: 0755
  with_items:
  - burp
  - burp_ca
  - vss_strip

- name: Burp | config
  tags:
  - config
  template:
    src: burp.conf.j2
    dest: /etc/burp/burp.conf
    mode: 0640

- name: Burp | cronjob
  tags:
  - cron
  copy:
    src: burp.cron
    dest: /etc/cron.daily/
    mode: 0750
